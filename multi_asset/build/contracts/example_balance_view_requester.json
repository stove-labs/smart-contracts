{
  "contractName": "example_balance_view_requester",
  "abi": [],
  "code": "[ { \"prim\": \"parameter\",\n    \"args\":\n      [ { \"prim\": \"or\",\n          \"args\":\n            [ { \"prim\": \"list\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"pair\",\n                            \"args\":\n                              [ { \"prim\": \"address\", \"annots\": [ \"%owner\" ] },\n                                { \"prim\": \"nat\", \"annots\": [ \"%token_id\" ] } ] },\n                          { \"prim\": \"nat\" } ] } ],\n                \"annots\": [ \"%receive_balance\" ] },\n              { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"address\",\n                            \"annots\": [ \"%asset_contract\" ] },\n                          { \"prim\": \"address\", \"annots\": [ \"%owner\" ] } ] },\n                    { \"prim\": \"nat\", \"annots\": [ \"%token_id\" ] } ],\n                \"annots\": [ \"%request_balance\" ] } ] } ] },\n  { \"prim\": \"storage\",\n    \"args\":\n      [ { \"prim\": \"list\",\n          \"args\":\n            [ { \"prim\": \"pair\",\n                \"args\":\n                  [ { \"prim\": \"pair\",\n                      \"args\":\n                        [ { \"prim\": \"address\", \"annots\": [ \"%owner\" ] },\n                          { \"prim\": \"nat\", \"annots\": [ \"%token_id\" ] } ] },\n                    { \"prim\": \"nat\" } ] } ] } ] },\n  { \"prim\": \"code\",\n    \"args\":\n      [ [ { \"prim\": \"SELF\" }, { \"prim\": \"ADDRESS\" },\n          { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n          { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" },\n          { \"prim\": \"IF_LEFT\",\n            \"args\":\n              [ [ { \"prim\": \"DUP\" },\n                  { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                  { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"DROP\" } ] ] } ],\n                [ { \"prim\": \"DUP\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DIP\",\n                            \"args\": [ { \"int\": \"2\" }, [ { \"prim\": \"DUP\" } ] ] },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"2\" } ] },\n                          { \"prim\": \"CDR\" } ] ] }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DUP\" }, { \"prim\": \"CAR\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"CAR\" }, { \"prim\": \"CAR\" },\n                  { \"prim\": \"CONTRACT\",\n                    \"args\":\n                      [ { \"prim\": \"pair\",\n                          \"args\":\n                            [ { \"prim\": \"list\",\n                                \"args\":\n                                  [ { \"prim\": \"pair\",\n                                      \"args\":\n                                        [ { \"prim\": \"address\",\n                                            \"annots\": [ \"%owner\" ] },\n                                          { \"prim\": \"nat\",\n                                            \"annots\": [ \"%token_id\" ] } ] } ],\n                                \"annots\": [ \"%balance_request\" ] },\n                              { \"prim\": \"contract\",\n                                \"args\":\n                                  [ { \"prim\": \"list\",\n                                      \"args\":\n                                        [ { \"prim\": \"pair\",\n                                            \"args\":\n                                              [ { \"prim\": \"pair\",\n                                                  \"args\":\n                                                    [ { \"prim\": \"address\",\n                                                        \"annots\":\n                                                          [ \"%owner\" ] },\n                                                      { \"prim\": \"nat\",\n                                                        \"annots\":\n                                                          [ \"%token_id\" ] } ] },\n                                                { \"prim\": \"nat\" } ] } ] } ],\n                                \"annots\": [ \"%balance_view\" ] } ] } ],\n                    \"annots\": [ \"%balance_of\" ] },\n                  { \"prim\": \"IF_NONE\",\n                    \"args\":\n                      [ [ { \"prim\": \"PUSH\",\n                            \"args\":\n                              [ { \"prim\": \"string\" },\n                                { \"string\":\n                                    \"bad address for get_entrypoint (%balance_of)\" } ] },\n                          { \"prim\": \"FAILWITH\" } ], [] ] },\n                  { \"prim\": \"DIP\", \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"CAR\" }, { \"prim\": \"CDR\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DIP\",\n                            \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n                          { \"prim\": \"SWAP\" }, { \"prim\": \"CDR\" } ] ] },\n                  { \"prim\": \"PAIR\" },\n                  { \"prim\": \"NIL\",\n                    \"args\":\n                      [ { \"prim\": \"pair\",\n                          \"args\":\n                            [ { \"prim\": \"address\", \"annots\": [ \"%owner\" ] },\n                              { \"prim\": \"nat\", \"annots\": [ \"%token_id\" ] } ] } ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"CONS\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DIP\",\n                            \"args\": [ { \"int\": \"4\" }, [ { \"prim\": \"DUP\" } ] ] },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"4\" } ] },\n                          { \"prim\": \"CONTRACT\",\n                            \"args\":\n                              [ { \"prim\": \"list\",\n                                  \"args\":\n                                    [ { \"prim\": \"pair\",\n                                        \"args\":\n                                          [ { \"prim\": \"pair\",\n                                              \"args\":\n                                                [ { \"prim\": \"address\",\n                                                    \"annots\": [ \"%owner\" ] },\n                                                  { \"prim\": \"nat\",\n                                                    \"annots\": [ \"%token_id\" ] } ] },\n                                            { \"prim\": \"nat\" } ] } ] } ],\n                            \"annots\": [ \"%receive_balance\" ] },\n                          { \"prim\": \"IF_NONE\",\n                            \"args\":\n                              [ [ { \"prim\": \"PUSH\",\n                                    \"args\":\n                                      [ { \"prim\": \"string\" },\n                                        { \"string\":\n                                            \"bad address for get_entrypoint (%receive_balance)\" } ] },\n                                  { \"prim\": \"FAILWITH\" } ], [] ] } ] ] },\n                  { \"prim\": \"PAIR\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DIP\",\n                            \"args\": [ [ { \"prim\": \"DUP\" } ] ] },\n                          { \"prim\": \"SWAP\" },\n                          { \"prim\": \"PUSH\",\n                            \"args\": [ { \"prim\": \"mutez\" }, { \"int\": \"0\" } ] } ] ] },\n                  { \"prim\": \"TRANSFER_TOKENS\" }, { \"prim\": \"DUP\" },\n                  { \"prim\": \"NIL\", \"args\": [ { \"prim\": \"operation\" } ] },\n                  { \"prim\": \"SWAP\" }, { \"prim\": \"CONS\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DIP\",\n                            \"args\": [ { \"int\": \"4\" }, [ { \"prim\": \"DUP\" } ] ] },\n                          { \"prim\": \"DIG\", \"args\": [ { \"int\": \"4\" } ] },\n                          { \"prim\": \"CDR\" } ] ] }, { \"prim\": \"PAIR\" },\n                  { \"prim\": \"DIP\",\n                    \"args\":\n                      [ [ { \"prim\": \"DROP\", \"args\": [ { \"int\": \"6\" } ] } ] ] } ] ] },\n          { \"prim\": \"DIP\",\n            \"args\": [ [ { \"prim\": \"DROP\", \"args\": [ { \"int\": \"2\" } ] } ] ] } ] ] } ]",
  "source": "#include \"./../partials/action.ligo\"\n#include \"./../partials/storage.ligo\"\ntype storage is balance_view_param;\ntype request_balance_param is record\n    asset_contract: address;\n    token_id: asset_id;\n    owner: asset_owner\nend;\ntype action is \n| Request_balance of request_balance_param\n| Receive_balance of balance_view_param\n\nconst receive_balance_entrypoint : string = \"%receive_balance\";\nconst current_contract : address = self_address;\n\nfunction on_balance_requested(const request_balance_param : request_balance_param; const storage : storage) : (list(operation) * storage)\n    is block {\n        const asset_contract_balance_of_entrypoint : contract(balance_of_param) = get_entrypoint(balance_of_entrypoint, request_balance_param.asset_contract);\n        const balance_of_operation_param : balance_of_param = record\n            balance_request = list\n                record\n                    owner = request_balance_param.owner;\n                    token_id = request_balance_param.token_id\n                end\n            end;\n            balance_view = (get_entrypoint(receive_balance_entrypoint, current_contract) : balance_view);\n        end;\n\n        const token_receiver_operation : operation = transaction(\n            balance_of_operation_param,\n            0mutez,\n            asset_contract_balance_of_entrypoint\n        );\n        \n        const operations : list(operation) = list\n            token_receiver_operation\n        end;\n\n        skip\n    } with (operations, storage) \n\n(*\n    This contract showcases an example implementation of the `On_multi_tokens_received` interface, and it stores\n    a counter of how many times has the receiver endpoint been invoked.\n*)\nfunction main (const action : action; const storage : storage) : (list(operation) * storage)\n    is (case action of\n        | Request_balance(request_balance_param) -> on_balance_requested(request_balance_param, storage)\n        | Receive_balance(balance_view_param) -> ((nil : list(operation)), balance_view_param)\n    end)",
  "sourcePath": "/Users/matejsima/Projects/stove-labs/smart-contracts/multi_asset/contracts/main/example_balance_view_requester.ligo",
  "compiler": {
    "name": "ligo",
    "version": "next"
  },
  "networks": {
    "NetXdQprcVkpaWU": {
      "events": {},
      "links": {},
      "address": "KT1EEycE75D6PiT4gJjeernAr4Zqk4wrWYkc",
      "transactionHash": "ons4MoRB8vfn5kLLRzvnErwjwiMMYaF9JXLyrRAf1MpfSAarSY3"
    }
  },
  "schemaVersion": "3.1.6-alphaTez.3",
  "updatedAt": "2020-01-21T12:23:07.743Z",
  "networkType": "tezos"
}